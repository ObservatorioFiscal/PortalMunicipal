
@{
    ViewBag.Title = "Carga Subsidios";
}


<div class="container">
    <div class="row seccion-destado">
        @if (ViewBag.aviso)
        {
            <div class="col-md-12">
                <div class="alert alert-danger" role="alert">
                    Esta informacion ya se encuentra cargada, si la vuelve a cargar se reemplaza la anterior.
                </div>
            </div>
        }

        <div class="col-md-12">
            <h1>
                Carga de Subsidios año
                <span class="muntotal">
                    @ViewBag.ano
                </span>
            </h1>
        </div>
        <div class="col-md-12">
            <form action="@Url.Action("CargaSubsidios","AdminComuna")" id="formulario" method="post" enctype="multipart/form-data">
                <input type="hidden" id="id" value="@ViewBag.id" />
                <label>
                    <span></span>
                    Archivo
                    <input type="file" accept=".xls,.xlsx" id="file" name="file" />
                    <input type="hidden" id="fileStatus" />
                    <span id="success" class="md-36 icon-Recurso15" style="display:none"></span>
                    <span id="error" class="md-36 icon-Recurso14" style="display:none"></span>
                </label><br />
                <input type="submit" class="btn" id="boton" value="Confirmar subida de Informacion">
            </form>
        </div>
    </div>
    <div class="row padding-Div"></div>
    <div class="row padding-Div"></div>
    <div class="row padding-Div"></div>
</div>

@section scripts{
    <script>
    $(document).ready(function () {

        $("#file").on("change", function () {
            upload('@Url.Action("ValidadorCargaSubsidios", "AdminComuna")', 'file', 'fileStatus')
        });

        //SI TODOS LOS HIDDEN

        $("#boton").on("click",function () {
            //si todos los type hidden en true, realiza el submit():
            if (1 == 1) {
                document.getElementById('formulario').submit();
            }
        });

        function upload(urlPath, name, result) {
            var isValid = undefined;
            var formData = new FormData();
            var file = document.getElementById(name).files[0];
            formData.append(name, file);
            $.ajax({
                type: 'post',
                url: urlPath,
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    $("#" + result).val(response);
                    checkSingleStatus(name,response);
                    checkAllStatus();
                }
            });
        }

        function checkAllStatus() {
            var isValid = $('#fileStatus').val();

            if (isValid == "true") {
                $('#boton').prop("disabled", false);
            } else {
                $('#boton').prop("disabled", true);
            }

        }

        function checkSingleStatus(item, result) {
            if (item == "file") {
                if (result == true) {
                    $('#success').css("display", "block");
                    $('#error').css("display", "none");
                }
                else {
                    $('#success').css("display", "none");
                    $('#error').css("display", "block");
                }
            }
        }
    });
    </script>
}