@{
    ViewBag.Title = "CargaDatos";
}

<div class="container">
    <div class="row seccion-destado">

        <div class="col-md-12">
            <h1>
                Carga de información año
                <small>
                    del año:
                    <span class="select">
                        @Html.DropDownList("name", (SelectList)ViewBag.Anos, null, new { @class = "muntotal", @id = "Anos" })
                    </span>
                </small>
                <small>
                    <a href="@Url.Action("AbrirPeriodo","AdminComuna")">( +abrir nuevo año )</a>
                </small>
            </h1>
        </div>
        <div class="col-md-12">
            <h2>Ingresos <small id="ingreso" class="paneladmin"></small></h2>
            <h2>Gastos <small id="gasto" class="paneladmin"></small></h2>
            <input type="hidden" class="dat0" value="@ViewBag.activos[0]" />
            <input type="hidden" class="dat1" value="@ViewBag.activos[1]" />
            <input type="hidden" class="dat2" value="@ViewBag.activos[2]" />
            <input type="hidden" class="dat3" value="@ViewBag.activos[3]" />

            @if (!ViewBag.activos[0] || !ViewBag.activos[1] || !ViewBag.activos[2] || !ViewBag.activos[3])
            {
                <h2>Datos Destacados</h2>
            }
            @if (ViewBag.activos[0])
            {
                <h5>&nbsp;&nbsp;&nbsp;&nbsp;<span>Proveedores</span> <small id="proveedor" class="paneladmin"></small></h5>
            }
            @if (ViewBag.activos[1])
            {
                <h5>&nbsp;&nbsp;&nbsp;&nbsp;<span>Subsidios</span> <small id="subsidio" class="paneladmin"></small></h5>
            }
            @if (ViewBag.activos[2])
            {
                <h5>&nbsp;&nbsp;&nbsp;&nbsp;<span>Corporaciones</span> <small id="corporacion" class="paneladmin"></small></h5>
            }
            @if (ViewBag.activos[3])
            {
                <h5>&nbsp;&nbsp;&nbsp;&nbsp;<span>Remuneraciones</span> <small id="remuneracion" class="paneladmin"></small></h5>
            }
            <h2 class="text-right">
                <a class="btn btn-primary" id="aceptarFinal" disabled="disabled">Activar Periodo</a><span class="cssToolTip"><span class="md-24 icon-Recurso-help amarillo"></span><span class="oculto">Primero tienes que tener cargada la información. Para que se active el boton. Si tienes otro periodo cargado  de este año, se eliminara automaticamente.</span></span>
            </h2>
        </div>
    </div>
    <div class="row padding-Div"></div>
    <div class="row padding-Div"></div>
</div>

@section scripts{
    <script src="~/Scripts/select.js"></script>


    <script type="text/javascript">
        $(document).ready(function () {

            $("select").resizeselect();
            Verdisponibilidad();

        });

        function Verdisponibilidad() {
            var suma = 2, contador=0;
            if ($("#dat0").val() == true) {
                suma++;
            }
            if ($("#dat1").val() == true) {
                suma++;
            }
            if ($("#dat2").val() == true) {
                suma++;
            }
            if ($("#dat3").val() == true) {
                suma++;
            }
            $.ajax({
                cache: false,
                async: false,
                type: 'POST',
                data: {
                    aux: $("#Anos").val()
                },
                url: '../AdminComuna/CargadosPost',
                dataType: 'json',
                success: function (data) {
                    $.each(data, function (i, item) {
                        var URLactual = window.location.pathname;
                        var tabla = URLactual.split('/')
                        var ano = $("#Anos").val();
                        if (!item[0]) {
                            $("#ingreso").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaIngresos/"+ano+"'>Cargar información</a>");
                        } else {
                            contador++;
                            $("#ingreso").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaIngresos/" + ano +"'>Recargar información</a>");
                        }
                        if (!item[1]) {
                            $("#gasto").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaGastos/" + ano +"'>Cargar información</a>");
                        } else {
                            contador++;
                            $("#gasto").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaGastos/" + ano +"'>Recargar información</a>");
                        }
                        if (!item[2]) {
                            $("#proveedor").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaProveedores/" + ano +"'>Cargar información</a>");
                        } else {
                            contador++;
                            $("#proveedor").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaProveedores/" + ano +"'>Recargar información</a>");
                        }
                        if (!item[3]) {
                            $("#subsidio").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaSubsidios/" + ano +"'>Cargar información</a>");
                        } else {
                            contador++;
                            $("#subsidio").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaSubsidios/" + ano +"'>Recargar información</a>");
                        }
                        if (!item[4]) {
                            $("#corporacion").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaCorporaciones/" + ano +"'>Cargar información</a>");;
                        } else {
                            contador++;
                            $("#corporacion").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaCorporaciones/" + ano +"'>Recargar información</a>");
                        }
                        if (!item[5]) {
                            contador++;
                            $("#remuneracion").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaRemuneraciones/" + ano +"'>Cargar información</a>");
                        } else {
                            $("#remuneracion").html("<a href='../../../" + tabla[1] + '/' + tabla[2] + "/CargaRemuneraciones/" + ano +"'>Recargar información</a>");
                        }
                    });
                    if (contador == suma) {
                        $("#aceptarFinal").removeAttr("disabled")
                    }

                },
                error: function (msg) {
                    $('#btnagendar').attr('disabled', false);
                }
            });
        }
        
    </script>
}

