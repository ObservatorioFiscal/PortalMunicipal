
@{
    ViewBag.Title = "Carga Ingresos";
}


<div class="container">
    <div class="row seccion-destado">
        @if (ViewBag.aviso)
        {
            <div class="col-md-12">
                <div class="alert alert-danger" role="alert">
                    Esta informacion ya se encuentra cargada, si la vuelve a cargar se reemplaza la anterior.
                </div>
            </div>
        }

        <div class="col-md-12">
            <h1>
                Carga de Ingresos año
                <span class="muntotal">
                    @ViewBag.ano
                </span>
            </h1>
        </div>
        <div class="col-md-12">
            <form action="@Url.Action("CargaIngresos","AdminComuna")" id="formulario" method="post" enctype="multipart/form-data">
                <label>
                    <span></span>
                    Adm. y Serv. Municipales     
                    <input type="file" accept=".xls,.xlsx" id="fileAdm" name="fileAdm" />
                    <input type="hidden" id="fileStatusAdm" />
                </label><br />
                
                <label>
                    Salud
                    <input type="file" accept=".xls,.xlsx" id="fileSalud" name="fileSalud" />
                    <input type="hidden" id="fileStatusSalud"/>
                </label><br />
                <label>
                    Educacion
                    <input type="file" accept=".xls,.xlsx" id="fileEducacion" name="fileEducacion" />
                    <input type="hidden"  id="fileStatusEducacion"/>
                </label><br />
                @if (ViewBag.cementerio)
                {

                <label>Cementerio                   
                    <input type="file" accept=".xls,.xlsx" id="fileCementerio" name="fileCementerio" />
                    <input type="hidden" id="fileStatusCementerio" />
                </label>

                }<br /><br />
                <input type="button" class="btn" id="boton" value="Confirmar subida de Informacion" disabled>
            </form>
        </div>
    </div>
    <div class="row padding-Div"></div>
    <div class="row padding-Div"></div>
    <div class="row padding-Div"></div>
</div>
@section scripts{
<script>
    $(document).ready(function () {

        $("#fileAdm").on("change", function () {
            upload('@Url.Action("ValidadorCargaIngresosAdm", "AdminComuna")', 'fileAdm', 'fileStatusAdm')
        });

        $("#fileSalud").on("change",function () {
            upload('@Url.Action("ValidadorCargaIngresosSalud", "AdminComuna")', 'fileSalud', 'fileStatusSalud')
        });
        $("#fileEducacion").on("change",function () {
            upload('@Url.Action("ValidadorCargaIngresosEducacion", "AdminComuna")', 'fileEducacion', 'fileStatusEducacion')
        });
        $("#fileCementerio").on("change",function () {
            upload('@Url.Action("ValidadorCargaIngresosCementerio", "AdminComuna")', 'fileCementerio', 'fileStatusCementerio')
        });

        //SI TODOS LOS HIDDEN

        $("#boton").on("click",function () {
            //si todos los type hidden en true, realiza el submit():
            if (1 == 1) {
                document.getElementById('formulario').submit();
            }
        });

        function upload(urlPath, name, result) {
            var isValid = undefined;
            var formData = new FormData();
            var file = document.getElementById(name).files[0];
            formData.append(name, file);
            $.ajax({
                type: 'post',
                url: urlPath,
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    $("#" + result).val(response);
                    checkStatus();
                }
            });
        }

        function checkStatus() {       
            var isValidAdm = $('#fileStatusAdm').val();
            var isValidSalud = $('#fileStatusSalud').val();
            var isValidEducacion = $('#fileStatusEducacion').val();
            var isValidCementerio = $('#fileStatusCementerio').val();
            console.log(isValidAdm);
            if (isValidAdm == "true" && isValidSalud == "true" && isValidEducacion == "true"){// && isValidCementerio == true) {
                $('#boton').prop("disabled", false);
            } else {
                $('#boton').prop("disabled", true);
            }
        }        
    });
</script>
}